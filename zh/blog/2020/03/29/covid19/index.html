<!doctype html><html lang=en-us><head><script type=text/javascript>var userLang=navigator.language||navigator.userLanguage;console.log(window.location.pathname),userLang.startsWith("zh")&&window.location.pathname=="/"&&(window.location.href="/zh/")</script><script type=text/javascript src=//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js data-dojo-config="usePlainJson: true, isDebug: false"></script><script type=text/javascript>window.dojoRequire(["mojo/signup-forms/Loader"],function(e){e.start({baseUrl:"mc.us4.list-manage.com",uuid:"6ace4137554cb923d96ec92c7",lid:"36ce78d7a8",uniqueMethods:!0})})</script>
<script async src=https://cdn.splitbee.io/sb.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>使用树莓派制作新冠病毒电子看板 | Lomorage</title><link href="https://fonts.googleapis.com/css?family=Lato:400" rel=stylesheet><script defer src=https://use.fontawesome.com/releases/v5.15.3/js/all.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-138235951-1","auto"),ga("send","pageview"))</script><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=stylesheet type=text/css href=/css/style.a2d4ddf024fd938e5bbbf2d62c2f17987b805f53b4cc89d360109c27d51e9458.min.css></head><body><div class="navbar navbar--extended"><nav class=nav__mobile></nav><div class=container><div class=navbar__inner><a href=/ class=navbar__logo>Lomorage</a><nav class=navbar__menu><ul><li><a href=/zh>主页</a></li><li><a href=https://lomosw.lomorage.com/zh/index.html class="button button__accent">立即下载</a></li><li><a href=/zh/survey/>调查问卷</a></li><li><a href=/zh/faq/>常见问题</a></li><li><a href=/zh/blog/>博客</a></li><li><a href=/zh/contact/>联系</a></li></ul></nav><div class=navbar__menu-mob><a href id=toggle><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M16 132h416c8.837.0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163.0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></a></div></div></div></div><div class=page__header><div class="hero__overlay hero__overlay--gradient"></div><div class=hero__mask></div><div class=page__header__inner><div class=container><div class=page__header__content><div class=page__header__content__inner id=navConverter><h1 class=page__header__title>使用树莓派制作新冠病毒电子看板</h1></div></div></div></div></div><div class=page><div class=container><div class=page__inner><div class=page__main><div class=text-container><p>新冠病毒肆掠全球，虽然现在可以很容易的在手机上查看新闻和数据，但是设置一个专门的电子看板，显示新闻和统计会更加方便。下面会讲解如何一步步的在树莓派上安装和配置“新冠病毒电子看板”。</p><div align=center><p class=screenshoot><img width=100% src=/img/blog/covid19/dashboard-zh.png></p></div><h1 id=目录>目录</h1><ul><li><a href=#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C>准备工作</a></li><li><a href=#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86>工作原理</a></li><li><a href=#%E5%AE%89%E8%A3%85>安装</a><ul><li><a href=#1-%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84nodejs>1. 安装最新版本的NodeJS</a></li><li><a href=#2-%E5%AE%89%E8%A3%85magicmirror>2. 安装MagicMirror</a></li><li><a href=#3-%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E6%A8%A1%E7%89%88>3. 使用默认的配置模版</a></li><li><a href=#4-%E5%AE%89%E8%A3%85mmm-covid19%E6%A8%A1%E5%9D%97>4. 安装MMM-COVID19模块</a></li><li><a href=#5-%E4%B8%BAmmm-covid19%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90>5. 为MMM-COVID19添加更多的数据源</a></li><li><a href=#6-%E8%8E%B7%E5%8F%96%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%A8%A1%E5%9D%97>6. 获取更多的模块</a></li></ul></li><li><a href=#%E5%87%86%E5%A4%87%E6%8A%95%E5%85%A5%E4%BD%BF%E7%94%A8>准备投入使用</a><ul><li><a href=#1-%E9%85%8D%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE>1. 配置树莓派</a></li><li><a href=#2-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8magicmirror>2. 开机启动MagicMirror</a></li><li><a href=#3-%E6%B7%BB%E5%8A%A0cronjob%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADmagicmirror>3. 添加Cronjob启动关闭MagicMirror</a></li></ul></li></ul><h1 id=准备工作>准备工作</h1><p>您需要一个树莓派和HDMI的显示器，你可以放置一个大屏幕在客厅，也可以在桌面上放置一个小屏幕作为摆台。</p><p><strong>注意: 树莓派0/1不支持，NodeJS不支持"armv6l"平台了。</strong></p><h1 id=工作原理>工作原理</h1><p>使用的开源软件有<a href=https://github.com/MichMich/MagicMirror>MagicMirror</a>和<a href=https://github.com/bibaldo/MMM-COVID19>covid-19模块</a>.</p><p>MagicMirror是一个开源的智能镜子平台, 但实际上使用它并不需要一面镜子，它可以被用来定制电子看板。MagicMirror的客户端和服务器程序使用了Nodejs，服务器通过http提供看板服务，客户端使用Electron，运行<a href="https://www.kioware.com/resources.aspx?resid=45">Kiosk模式</a>, 也就是浏览器的全屏模式, 您也可以运行<a href=https://docs.magicmirror.builders/getting-started/installation.html#usage>&ldquo;服务器模式&rdquo;</a>，并在另外一台电脑的浏览器上访问电子看板。</p><p>MagicMirror定义的如下的布局，您可以选择把模块放置的看板特定的位置。</p><p><img src=/img/blog/covid19/layout.png alt=layout></p><p>模块定义了如何获取和显示数据。</p><p>大体上来说就这么简单!</p><h1 id=安装>安装</h1><p>如果您使用的是lite的系统镜像，您需要先安装桌面系统。</p><pre tabindex=0><code>sudo apt-get update 
sudo apt-get -y dist-upgrade
sudo apt-get install raspberrypi-ui-mods -y
sudo apt-get install libgdk-pixbuf2.0-dev -y
sudo ln -s /usr/lib/*/gdk-pixbuf-2.0/gdk-pixbuf-query-loaders /usr/local/bin/gdk-pixbuf-query-loaders
sudo gdk-pixbuf-query-loaders --update-cache -y
sudo apt install ca-certificates python-certifi python3-certifi -y
sudo apt-get install -y --reinstall ca-certificates
sudo update-ca-certificates --fresh
</code></pre><h2 id=1-安装最新版本的nodejs>1. 安装最新版本的NodeJS</h2><p><a href=https://github.com/audstanley/NodeJs-Raspberry-Pi>NodeJs-Raspberry-Pi</a>能非常方便的一行命令安装NodeJS:</p><pre tabindex=0><code>$ wget -O - https://raw.githubusercontent.com/audstanley/NodeJs-Raspberry-Pi/master/Install-Node.sh | sudo bash; node -v
</code></pre><p><em>使用"apt install"很有可能不会安装新版本的NodeJS，MagicMirror在后续的安装过程只会报错。</em></p><h2 id=2-安装magicmirror>2. 安装MagicMirror</h2><pre tabindex=0><code>$ git clone https://github.com/MichMich/MagicMirror
$ cd MagicMirror/
$ npm install
</code></pre><h2 id=3-使用默认的配置模版>3. 使用默认的配置模版</h2><p>MagicMirror已经安装了一些<a href=https://docs.magicmirror.builders/getting-started/configuration.html#general>默认模块</a>.</p><pre tabindex=0><code># 假设在MagicMirror目录
$ cp config/config.js.sample config/config.js

# 可以使用&#34;ctrl+c&#34;停止, 下面的运行方式仅仅用于测试
$ npm run
</code></pre><p>您可以尝试去修改"config.js"中模块的选项，比如，您可以给"News Feed"模块添加更多的<a href=https://docs.rsshub.app/>RSS源</a>:</p><pre tabindex=0><code>{
   title: &#34;BBC&#34;,
   url: &#34;http://feeds.bbci.co.uk/news/video_and_audio/news_front_page/rss.xml?edition=us&#34;
},
</code></pre><p>您也可以更加上面的布局图来修改模块的位置（&ldquo;position"参数）。</p><p>您也可以修改默认的语言（&ldquo;language"参数)，<a href=https://github.com/MichMich/MagicMirror/tree/master/translations>https://github.com/MichMich/MagicMirror/tree/master/translations</a>可以查看所有可用的语言选项。改成其他语言要记得安装相关的字体，比如中文字体:</p><pre tabindex=0><code>sudo apt install -y fonts-arphic-uming ttf-wqy-microhei
</code></pre><h2 id=4-安装mmm-covid19模块>4. 安装MMM-COVID19模块</h2><p>将模块安装在"modules"目录下:</p><pre tabindex=0><code># 假设在MagicMirror目录
$ cd modules
$ git clone https://github.com/bibaldo/MMM-COVID19
</code></pre><p>然后在"config/config.js"文件中添加模块的配置, 在<a href=https://rapidapi.com/>https://rapidapi.com/</a>注册，将下面的"get-your-api-key"替换为您自己的API密钥。<a href=https://rapidapi.com/astsiatsko/api/coronavirus-monitor>https://rapidapi.com/astsiatsko/api/coronavirus-monitor</a>，&ldquo;X-RapidAPI-Key"就是API密钥。</p><pre tabindex=0><code>  {
    module: &#39;MMM-COVID19&#39;,
    position: &#34;bottom_bar&#34;,
    config: {
      headerRowClass: &#34;big&#34;,
      infoRowClass: &#34;big&#34;,
      worldStats: true,
      countries: [&#34;USA&#34;, &#34;China&#34;],
      lastUpdateInfo: true,
      delta: true,
      rapidapiKey: &#34;get-your-api-key&#34;,
   }
  },
</code></pre><p>修改了"config/config.js"后，您需要重启MagicMirror。</p><h2 id=5-为mmm-covid19添加更多的数据源>5. 为MMM-COVID19添加更多的数据源</h2><p>默认的数据源缺少一些详细信息，比如没有美国每个郡县的统计，没有中国城市的统计。您也可以添加其他的数据源，但那个就不仅仅是简单的配置了，需要修改一些代码，因为不同的数据源的格式不一样。</p><p>这里有个<a href=https://github.com/fuji246/MMM-COVID19/commit/42356ae5f922359a0b961328a43eddb0d61c4058>改动示例</a>添加了美国郡县的统计数据，并做了汉化。这个<a href=https://github.com/fuji246/MMM-COVID19/commit/e4d9850a1faf3631bebf10b11fd70133a8921296>改动示例</a>添加了中国城市的统计数据。</p><p>美国的数据来源<a href=https://github.com/ExpDev07/coronavirus-tracker-api>https://github.com/ExpDev07/coronavirus-tracker-api</a>，中国的数据来源<a href=https://c.m.163.com/ug/api/wuhan/app/data/list-total>https://c.m.163.com/ug/api/wuhan/app/data/list-total</a>，都不需要申请API密钥。</p><p>其他的数据源<a href=https://github.com/pomber/covid19>https://github.com/pomber/covid19</a>, 您也可以自行去网上查找合适的数据源，并对代码做相应的改动。</p><h2 id=6-获取更多的模块>6. 获取更多的模块</h2><p>这个<a href=https://github.com/MichMich/MagicMirror/wiki/3rd-Party-Modules>wiki</a>列举了所有的第三方模块。最上面的示例图片使用了下面的模块:</p><ul><li><p><a href=https://github.com/KirAsh4/calendar_monthly/>calendar_monthly</a></p></li><li><p><a href=https://github.com/eouia/worldclock>worldclock</a></p></li></ul><p>您也可以根据自己的需求尝试其他的模块。</p><h1 id=准备投入使用>准备投入使用</h1><p>测试好电子看板后，您还需要一些额外的配置，才能将其投入使用。</p><h2 id=1-配置树莓派>1. 配置树莓派</h2><p>您需要关掉屏保，禁止无线网卡的休眠模式，打开OpenGL驱动，参考<a href=https://github.com/MichMich/MagicMirror/wiki/Configuring-the-Raspberry-Pi>wiki</a>进行配置。</p><p><em>注意: 关闭屏保那一步，在修改&rdquo;/etc/xdg/lxsession/LXDE-pi/autostart"文件时, 需要注释掉这一行&rdquo;@xscreensaver -no-splash&rdquo;（使用#），这个在上面的说明里面没有</em></p><pre tabindex=0><code>@lxpanel --profile LXDE-pi
@pcmanfm --desktop --profile LXDE-pi
#@xscreensaver -no-splash
@xset s noblank
@xset s off
@xset -dpms
</code></pre><h2 id=2-开机启动magicmirror>2. 开机启动MagicMirror</h2><p>参考<a href=https://github.com/MichMich/MagicMirror/wiki/Auto-Starting-MagicMirror>wiki</a>设置MagicMirror开机启动。</p><p><em>注意: 如果安装了pm2后却找不到这个命令，您需要将<code>PATH="/opt/nodejs/bin:$PATH"</code>添加到"~/.profile"文件中，然后<code>source ~/.profile</code>更新PATH环境变量</em></p><h2 id=3-添加cronjob启动关闭magicmirror>3. 添加Cronjob启动关闭MagicMirror</h2><p>在"/var/spool/cron/crontabs/pi"文件中添加如下的内容，控制MagicMirror在早上8 am启动，晚上9 pm关闭，并打开和关闭HDMI显示器。</p><pre tabindex=0><code>00 08 * * * vcgencmd display_power 1;pm2 start mm
00 21 * * * vcgencmd display_power 0;pm2 stop mm
</code></pre></div><div id=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//lomorage.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div></div><div class="footer footer--dark"><div class=container><div class=footer__inner><a href=/ class=footer__textLogo>Lomorage</a><div class=footer__data><div class=footer__data__item><div class=footer__row><a href=https://github.com/lomorage/homepage target=_blank style=opacity:1><i class='fab fa-2x fa-github'></i></a></div></div><div class=footer__data__item><div class=footer__row><a href=https://join.slack.com/t/lomorage/shared_invite/enQtODc4MTE5ODQzNzkyLTRlY2U4MTQ1YjczYjBhMDcwMmExYTUxNTg2NTE5YmRkZjg2ZWQwZjg1MjEwMjQzZWVjMmEwZjk3ZGIyODY4ODM target=_blank style=opacity:1><i class='fab fa-2x fa-slack'></i></a></div></div><div class=footer__data__item><div class=footer__row><a href=mailto:support@lomorage.com target=_blank style=opacity:1><i class='fa fa-2x fa-envelope'></i></a></div></div></div></div><div class=footer__inner></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://unpkg.com/ionicons@4.4.7/dist/ionicons.js></script><div class=scripts><script type=text/javascript src=/js/scripts.min.bb1d06f8e905fb867381210826b837409d2fb4c30c4601b82488ca210441ab4e.js></script></div></body></html>